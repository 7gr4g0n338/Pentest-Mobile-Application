# How to use Frida tool and API pentest for mobile applications

Goals of this tutorial:
+ What is Frida?
+ How to use Frida tool to hooking mobile applications and bypass security features which are used to detect root/jailbreak devices.
+ Pentest mobile app API to find as many vulnerabilities as possible.

Tables of contents:
1. [What is Frida?](#1-what-is-frida)
2. [How to use Frida tool to hooking mobile applications and bypass security features which are used to detect root/jailbreak devices](#2-how-to-use-frida-tool-to-hooking-mobile-applications-and-bypass-security-features-which-are-used-to-detect-rootjailbreak-devices)
3. [Pentest mobile app API to find as many vulnerabilities as possible](#3-pentest-mobile-app-api-to-find-as-many-vulnerabilities-as-possible)
4. [Thanks to the author of the tool and my mentor for the support and help.](#4-thanks-to-the-author-of-the-tool-and-my-mentor-for-the-support-and-help)

## 1. What is Frida?
https://github.com/frida

### 1.1. Concept of Frida
+ Frida is a powerful and flexible tool commonly used in pentesting (security testing) for mobile and desktop applications.

+ allows pentesters and security researchers to intervene and modify the behavior of applications without having to have the source code.

### 1.2. Main features of Frida:

+ Hooking và Intercepting: allows you to intercept and manipulate specific functions or methods in a running application.

+ Multiple platform and scriptable: provides an easy-to-use API for writing JavaScript code that runs within the context of the running application.

+ Dynamic instrumentation: Frida allows analyzing application changes in real time without having to recompile the application, which is very convenient when testing applications without source code.

+ can be integrated with other tools like Burp Suite, IDA Pro, or Ghidra, extending analysis and pentesting capabilities.

### 1.3. How do Frida work?

+ Frida runs JavaScript scripts directly in the target app's process.

+ When deploying Frida on a device (like a rooted Android phone or a jailbroken iOS device), it allows you to inject hooks into your app and monitor and modify your app's data flow and function calls.

### 1.4. Common Applications of Frida
+ Malware Analysis: Frida helps analyze the behavior of malicious applications by intercepting sensitive APIs or methods, allowing testers to observe the actions of the malicious code.

+ Application Security Testing: Developers or pentesters can use Frida to test the security of their applications, especially those with multiple layers of encryption, authentication, and integrity checks.

+ Bypassing Security Measures: Frida can help bypass measures such as SSL Pinning or root/jailbreak testing, allowing pentesters to test the application more comprehensively.

## 2. How to use Frida tool to hooking mobile applications and bypass security features which are used to detect root/jailbreak devices.
Frida is especially useful in bypassing common security measures like SSL Pinning and root/jailbreak checks. => Comprehensive application analysis without being limited by protection layers.

Frida help:
+ MITM made easy: SSL Pinning bypass allows you to analyze the transmitted data, helping to check for vulnerabilities and network security issues in the application.

+ Analyze restricted functions: Root/jailbreak bypass allows you to have full access to the application on rooted devices, thereby performing more in-depth testing and inspection without any limitations.

### 2.1. Bypassing SSL Pinning

+ SSL Pinning is a security technique commonly used in applications to verify that the SSL certificate of the server the application is connecting to is valid. => To prevent applications from being attacked by Man-in-the-Middle (MITM), which can intercept and modify network traffic.

+ SSL Pinning can be problematic because it prevents you from viewing the transmitted data to test for security vulnerabilities. => Frida can help bypass this security measure:

    + Hook SSL-related functions: Frida allows you to hook into SSL functions in your application, such as `SSLHandshake`, `SSL_set_fd`, or functions related to certificate verification. With a simple Frida script, you can bypass or disable your application's SSL certificate checks.

    + Using Frida SSL Unpinning Scripts: The security community has many scripts available for Frida to disable SSL Pinning, especially for popular libraries such as `OkHttp`, `TrustKit`, or `AFNetworking`. These scripts often hook into relevant functions to prevent the application from checking SSL certificates, allowing pentesters to perform MITM attacks to inspect data.

Example:
This script hooks into the `verifyChain` function and returns an unchecked certificate chain, which bypasses the SSL validation process in Android applications.
```markdown
Java.perform(function () {
    var TrustManagerImpl = Java.use('com.android.org.conscrypt.TrustManagerImpl');
    TrustManagerImpl.verifyChain.implementation = function (untrustedChain, trustAnchorChain, hostname) {
        return untrustedChain;
    };
});

```

### 2.2. Bypassing Root/Jailbreak Detection

+ Many apps implement root/jailbreak checks to determine if a device is rooted or jailbroken, this can help protection against agents that may interfere with the application. => Frida can help bypass this security measure:
    + Hook root/jailbreak checking functions: Apps often use specific methods to check for signs of root/jailbreak, such as checking for the existence of sensitive files (`/system/xbin/su`, `/system/app/Superuser.apk`, etc.), checking for access to the su command, or checking for root management packages like `SuperSU` or `Magisk`. => Frida can hook into these functions and prevent them from returning positive results.
    + Disable common root/jailbreak checks: Some Frida scripts can completely disable common checks like `checkRootMethod1`, `checkSuExists`, or checking for the existence of root packages.

Example:
This Frida script can spoof test results by returning "no root" when the application checks.
```markdown
Java.perform(function () {
    var RootChecker = Java.use('com.example.RootDetection');
    RootChecker.isRooted.implementation = function () {
        return false; // Giả mạo là thiết bị chưa root
    };
});
```

## 3. Pentest mobile app API to find as many vulnerabilities as possible.

+ Report vulnerabilities in file "Android-insecurityBank Security report.xlsx"

+ All vulnerabilities Image:
![All vulnerabilities](/Image/Screenshot_1.png)

+ Report vulnerabilities Image:
![Report vulnerabilities](/Image/Screenshot_2.png)

+ Evidence vulnerabilities Image:
![Evidence vulnerabilities](/Image/Screenshot_3.png)

## 4. Thanks to the author of the tool and my mentor for the support and help.

+ https://github.com/frida

+ Thanh you very much for your support and help, my bro - DucAnh-Dan.